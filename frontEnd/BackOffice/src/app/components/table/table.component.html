<div id="app">
    <div id="main">
      <div class="page-heading">
        <!-- Users Table -->
        <section class="section">
          <div class="row" id="table-head">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">Users List</h4>
                </div>
                <div class="card-content">
                  <div class="table-responsive">
                    <table class="table mb-0">
                      <thead class="thead-dark">
                        <tr>
                          <th>ID</th>
                          <th>Nom</th>
                          <th>Email</th>
                          <th>Rôle</th>
                          <th>Verification</th>
                          <th>Etat</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let user of users">
                          <td class="text-bold-500">{{ user.id }}</td>
                          <td class="text-bold-500">{{ user.name }}</td>
                          <td class="text-bold-500">{{ user.email }}</td>
                          <td class="text-bold-500">{{ user.role }}</td>
                          <td class="text-bold-500">{{ user.is_verified }}</td>
                          <td class="text-bold-500">{{ user.is_accepted }}</td>
                          <td>
                            <button *ngIf="user.is_accepted === 'Non accepté'"
                              (click)="acceptUser(user.id)"
                              class="btn btn-success">Accepter</button>
                            <button *ngIf="user.is_accepted === 'Accepté'"
                              (click)="blockUser(user.id)"
                              class="btn btn-danger">Bloquer</button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
  
        <!-- Stages Table -->
        <section class="section">
          <div class="row" id="table-striped">
            <div class="col-12">
              <div class="card">
                <div class="card-header">
                  <h4 class="card-title">List Stage</h4>
                </div>
                <div class="card-content">
                  <div class="table-responsive">
                    <table class="table table-striped mb-0">
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Description</th>
                          <th>Fichier</th>
                          <th>Nom</th>
                          <th>Propriétaire</th>
                          <th>Type</th>
                          <th>Répertoire d'Upload</th>
                          <th>ID Utilisateur</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let stage of stages">
                          <td class="text-bold-500">{{ stage.id }}</td>
                          <td class="text-bold-500">{{ stage.description }}</td>
                          <td class="text-bold-500">
                            <button (click)="viewStageFile(stage.id)" class="btn btn-info">
                              Télécharger
                            </button>
                          </td>
                          <td class="text-bold-500">{{ stage.name }}</td>
                          <td class="text-bold-500">{{ stage.ownedBy }}</td>
                          <td class="text-bold-500">{{ stage.type }}</td>
                          <td class="text-bold-500">{{ stage.uploadDir }}</td>
                          <td class="text-bold-500">{{ stage.user?.nom }}</td>
                          <td>
                            <button (click)="editStage(stage.id)" class="btn btn-primary me-2">
                              Éditer
                            </button>
                            <button (click)="deleteStage(stage.id)" class="btn btn-danger">
                              Supprimer
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
  
         <!-- Reservations Table -->
 <!-- Reservations Table -->
  
  <!-- Reservations Table -->
  <section class="section">
    <div class="row" id="table-striped-dark">
      <div class="col-12">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title mb-0">Gestion des Réservations</h4>
            <div class="btn-group">
              <button class="btn btn-outline-secondary" (click)="sortByStatus()">
                <i class="bi me-2" [ngClass]="{
                  'bi-sort-down': sortByStatusOrder === 'asc',
                  'bi-sort-up': sortByStatusOrder === 'desc'
                }"></i>
                Trier par Statut
              </button>
              <button class="btn btn-outline-secondary" (click)="sortByDate()">
                <i class="bi me-2" [ngClass]="{
                  'bi-sort-down': sortByDateOrder === 'asc',
                  'bi-sort-up': sortByDateOrder === 'desc'
                }"></i>
                Trier par Date
              </button>
            </div>
          </div>
          <div class="card-content">
            <div class="table-responsive">
              <table class="table table-dark mb-0">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Étudiant</th>
                    <th>Date</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngIf="reservations.length === 0">
                    <td colspan="5" class="text-center">Aucune réservation trouvée</td>
                  </tr>
                  
                  <tr *ngFor="let res of reservations">
                    <td>{{ res.id }}</td>
                    <td>{{ res.studentId }}</td>
                    <td>{{ res.dateReservation ? (res.dateReservation | date:'dd/MM/yyyy') : 'N/A' }}</td>
                    <td>
                      <select [(ngModel)]="res.statut" 
                              class="form-select form-select-sm"
                              [class.bg-warning]="res.statut === 'En attente'"
                              [class.bg-success]="res.statut === 'Accepté'"
                              [class.bg-danger]="res.statut === 'Refusé'">
                        <option value="En attente">En attente</option>
                        <option value="Accepté">Accepté</option>
                        <option value="Refusé">Refusé</option>
                      </select>
                    </td>
                    <td>
                      <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-success"
                                (click)="updateStatus(res.id, res.statut)">
                          <i class="bi bi-save"></i>
                        </button>
                        <button class="btn btn-sm btn-danger"
                                (click)="deleteReservation(res.id)">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Pie Chart Section -->
<section class="section">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header text-center">
            <h4 class="card-title">Statistiques des Réservations</h4>
          </div>
          <div class="card-body">
            <div class="chart-container mx-auto" style="max-width: 600px; height: 400px;">
              <canvas baseChart 
                  [data]="pieChartData"
                  [options]="pieChartOptions"
                  type="pie">
              </canvas>
            </div>
            <div class="mt-3 text-center">
              <small class="text-muted">
                Total: {{ reservations.length }} réservation(s)
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>